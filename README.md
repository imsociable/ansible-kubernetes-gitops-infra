# üöÄ GitOps k3s Infrastructure (Cilium + Argo CD)

Zero-touch GitOps-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è Kubernetes –Ω–∞ –±–∞–∑–µ k3s.  
–ü—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª: –æ—Ç –ø—É—Å—Ç–æ–π VM –¥–æ —É–ø—Ä–∞–≤–ª—è–µ–º–æ–≥–æ —á–µ—Ä–µ–∑ Git –∫–ª–∞—Å—Ç–µ—Ä–∞
—Å –Ω–∞–±–ª—é–¥–∞–µ–º–æ–π —Å–µ—Ç—å—é, –º–µ—Ç—Ä–∏–∫–∞–º–∏ –∏ –ª–æ–≥–∞–º–∏.

---

## ‚ú® Overview

–ü–æ –æ–¥–Ω–æ–º—É –∑–∞–ø—É—Å–∫—É Ansible –Ω–∞ –ø—É—Å—Ç–æ–π VM –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è:

- üß± k3s (–±–µ–∑ flannel)
- üåê Cilium (CNI)
- üîÅ Argo CD
- üîê Sealed Secrets
- üìä Observability stack (metrics + logs + alerts)

–ü–æ—Å–ª–µ bootstrap **–≤—Å—è –¥–∞–ª—å–Ω–µ–π—à–∞—è —Ä–∞–±–æ—Ç–∞ –≤–µ–¥—ë—Ç—Å—è —á–µ—Ä–µ–∑ Git (GitOps)**.

---

## üß≠ Architecture
VM (Cloud / VPS)
 ‚îî‚îÄ Ansible
     ‚îî‚îÄ k3s (–±–µ–∑ flannel)
         ‚îî‚îÄ Cilium
             ‚îú‚îÄ Hubble (network observability)
             ‚îú‚îÄ Argo CD
             ‚îÇ    ‚îî‚îÄ GitOps repository
             ‚îÇ         ‚îî‚îÄ Observability stack
             ‚îÇ              ‚îú‚îÄ Prometheus (+ exporters)
             ‚îÇ              ‚îú‚îÄ Grafana
             ‚îÇ              ‚îú‚îÄ Alertmanager
             ‚îÇ              ‚îú‚îÄ Loki + Promtail
             ‚îÇ              ‚îî‚îÄ PostgreSQL (+ metrics backup script)
–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ –¥–≤–∞ —Å–ª–æ—è:

- üõ† **Bootstrap layer** ‚Äî –≤—Å—ë –¥–æ Argo CD
- üîÑ **GitOps layer** ‚Äî –≤—Å—ë, —á–µ–º —É–ø—Ä–∞–≤–ª—è–µ—Ç Argo CD

---

## üõ† Bootstrap layer (Ansible)

Ansible –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –¥–ª—è –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—è**:

- —É—Å—Ç–∞–Ω–æ–≤–∫–∞ k3s —Å –æ—Ç–∫–ª—é—á—ë–Ω–Ω—ã–º flannel
- —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Cilium —á–µ—Ä–µ–∑ Helm (zero-touch)
- —É—Å—Ç–∞–Ω–æ–≤–∫–∞ Argo CD
- —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Sealed Secrets

–ü–æ—Å–ª–µ bootstrap:
- ‚ùå —Ä—É—á–Ω—ã–µ `kubectl apply` –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
- ‚úÖ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–ª–∞—Å—Ç–µ—Ä–∞ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ Git

---

## üîÑ GitOps layer (Argo CD)

Argo CD –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞:

- —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞ –∏–∑ Git
- Helm-–¥–µ–ø–ª–æ–π —Å –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏ (`Chart.lock`)
- self-healing –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤

–ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ.

---

## üåê Networking

- **Cilium** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π CNI (eBPF)
- –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ pod-to-pod
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã Network Policies

---

## üìä Observability

### üìà Metrics

- Prometheus:
  - node-exporter
  - blackbox-exporter
  - postgres-exporter

### ü™µ Logs

- Loki + Promtail
- –õ–æ–≥–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ Grafana (Explore –∏ dashboards)

### üö® Alerts

- Alertmanager

### üóÑ Metrics persistence

- PostgreSQL
- Python-—Å–∫—Ä–∏–ø—Ç:
  - –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Å–µ—Ç–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (blackbox ping) –∏–∑ Prometheus
  - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ PostgreSQL –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –∏ –∏—Å—Ç–æ—Ä–∏–∏

---

## üß© Key properties

- ‚öôÔ∏è zero-touch bootstrap Kubernetes-–∫–ª–∞—Å—Ç–µ—Ä–∞
- üß± —á—ë—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ bootstrap / GitOps —Å–ª–æ—ë–≤
- üìú –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
- ‚ôªÔ∏è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏—è
- üîç –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å —Å–µ—Ç–∏, –º–µ—Ç—Ä–∏–∫ –∏ –ª–æ–≥–æ–≤
- üß† –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–µ–Ω—è—Ç—å –ª—é–±–æ–π —Å–ª–æ–π –±–µ–∑ —Ä—É—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞ VM

---

## üß∞ Tech stack

- Kubernetes (k3s)
- Cilium,
- Helm
- Argo CD
- Ansible
- Prometheus, Grafana, Alertmanager
- Loki, Promtail
- PostgreSQL
- Python
- Linux

