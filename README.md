# ๐ GitOps k3s Infrastructure (Cilium + Argo CD)

Zero-touch GitOps-ะธะฝััะฐััััะบัััะฐ ะดะปั Kubernetes ะฝะฐ ะฑะฐะทะต k3s.  
ะัะพะตะบั ะดะตะผะพะฝัััะธััะตั ะฟะพะปะฝัะน ัะธะบะป: ะพั ะฟัััะพะน VM ะดะพ ัะฟัะฐะฒะปัะตะผะพะณะพ ัะตัะตะท Git ะบะปะฐััะตัะฐ
ั ะฝะฐะฑะปัะดะฐะตะผะพะน ัะตััั, ะผะตััะธะบะฐะผะธ ะธ ะปะพะณะฐะผะธ.

---

## โจ Overview

ะะพ ะพะดะฝะพะผั ะทะฐะฟััะบั Ansible ะฝะฐ ะฟัััะพะน VM ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะฐะทะฒะพัะฐัะธะฒะฐะตััั:

- ๐งฑ k3s (ะฑะตะท flannel)
- ๐ Cilium (CNI)
- ๐ Argo CD
- ๐ Sealed Secrets
- ๐ Observability stack (metrics + logs + alerts)

ะะพัะปะต bootstrap **ะฒัั ะดะฐะปัะฝะตะนัะฐั ัะฐะฑะพัะฐ ะฒะตะดัััั ัะตัะตะท Git (GitOps)**.

---

## ๐งญ Architecture
```
platform/
โโโ README.md               
โโโ .gitignore              
โ
โโโ ansible/                # infra-repo
โ   โโโ inventory/
โ   โโโ roles/
โ   โโโ playbook.yml
โ
โโโ kubernetes-config/             # apps-repo (ัะบะพะฟะธัะพะฒะฐะฝ ััะดะฐ ะดะปั ัะดะพะฑััะฒะฐ ะฟัะพัะผะพััะฐ, ัััะปะบะธ ะฒ ะบะพะดะต ัะบะฐะทะฐะฝั ะฝะฐ ะฟัะธะฒะฐัะฝัะน ัะตะฟะพะทะธัะพัะธะน)
    โโโ argocd/          # ArgoCD App of Apps 
    โ   โโโ bootstrap/
    โ       โโโ monitoring-stack.yaml
    โ       โโโ sealed-secrets.yaml (infra)
    โ
    โโโ helm/        
        โโโ my-chart/  
            โโโ Chart.yaml          
            โโโ Chart.lock        
            โโโ values.yaml         
            โโโ templates/         
                โโโ sealed-secrets.yaml (apps)
                โโโ ...
```
ะะฝััะฐััััะบัััะฐ ัะฐะทะดะตะปะตะฝะฐ ะฝะฐ ะดะฒะฐ ัะปะพั:

- ๐ **Bootstrap layer** โ ะฒัั ะดะพ Argo CD
- ๐ **GitOps layer** โ ะฒัั, ัะตะผ ัะฟัะฐะฒะปัะตั Argo CD

---

## ๐ Bootstrap layer (Ansible)

Ansible ะธัะฟะพะปัะทัะตััั **ัะพะปัะบะพ ะดะปั ะฟะตัะฒะธัะฝะพะณะพ ัะฐะทะฒััััะฒะฐะฝะธั**:

- ัััะฐะฝะพะฒะบะฐ k3s ั ะพัะบะปัััะฝะฝัะผ flannel
- ัััะฐะฝะพะฒะบะฐ Cilium ัะตัะตะท Helm (zero-touch)
- ัััะฐะฝะพะฒะบะฐ Argo CD
- ัััะฐะฝะพะฒะบะฐ ะธ ะฝะฐัััะพะนะบะฐ Sealed Secrets

ะะพัะปะต bootstrap:
- โ ัััะฝัะต `kubectl apply` ะฝะต ะธัะฟะพะปัะทััััั
- โ ัะพััะพัะฝะธะต ะบะปะฐััะตัะฐ ัะฟัะฐะฒะปัะตััั ัะพะปัะบะพ ัะตัะตะท Git

---

## ๐ GitOps layer (Argo CD)

Argo CD ะพัะฒะตัะฐะตั ะทะฐ:

- ัะธะฝััะพะฝะธะทะฐัะธั ัะพััะพัะฝะธั ะบะปะฐััะตัะฐ ะธะท Git
- Helm-ะดะตะฟะปะพะน ั ะทะฐัะธะบัะธัะพะฒะฐะฝะฝัะผะธ ะทะฐะฒะธัะธะผะพัััะผะธ (`Chart.lock`)
- self-healing ะฟัะธ ัะดะฐะปะตะฝะธะธ ะธะปะธ ะธะทะผะตะฝะตะฝะธะธ ัะตััััะพะฒ

ะะทะผะตะฝะตะฝะธั ะฒ ัะตะฟะพะทะธัะพัะธะธ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟัะธะผะตะฝััััั ะฒ ะบะปะฐััะตัะต.

---

## ๐ Networking

- **Cilium** ะธัะฟะพะปัะทัะตััั ะบะฐะบ ะพัะฝะพะฒะฝะพะน CNI (eBPF)
- ะัะพะฒะตัะตะฝะพ ะฒะทะฐะธะผะพะดะตะนััะฒะธะต pod-to-pod
- ะัะพัะตััะธัะพะฒะฐะฝั Network Policies

---

## ๐ Observability

### ๐ Metrics

- Prometheus:
  - node-exporter
  - blackbox-exporter
  - postgres-exporter

### ๐ชต Logs

- Loki + Promtail
- ะะพะณะธ ะดะพัััะฟะฝั ะฒ Grafana (Explore ะธ dashboards)

### ๐จ Alerts

- Alertmanager

### ๐ Metrics persistence

- PostgreSQL
- Python-ัะบัะธะฟั:
  - ะธะทะฒะปะตะบะฐะตั ัะตัะตะฒัะต ะผะตััะธะบะธ (blackbox ping) ะธะท Prometheus
  - ัะพััะฐะฝัะตั ะธั ะฒ PostgreSQL ะดะปั ะดะพะปะณะพััะพัะฝะพะณะพ ะฐะฝะฐะปะธะทะฐ ะธ ะธััะพัะธะธ

---

## ๐งฉ Key properties

- โ๏ธ zero-touch bootstrap Kubernetes-ะบะปะฐััะตัะฐ
- ๐งฑ ัััะบะพะต ัะฐะทะดะตะปะตะฝะธะต bootstrap / GitOps ัะปะพัะฒ
- ๐ ะดะตะบะปะฐัะฐัะธะฒะฝะพะต ัะฟัะฐะฒะปะตะฝะธะต ะธะฝััะฐััััะบัััะพะน
- โป๏ธ ะฒะพัะฟัะพะธะทะฒะพะดะธะผะพััั ะพะบััะถะตะฝะธั
- ๐ ะฝะฐะฑะปัะดะฐะตะผะพััั ัะตัะธ, ะผะตััะธะบ ะธ ะปะพะณะพะฒ
- ๐ง ะฒะพะทะผะพะถะฝะพััั ะผะตะฝััั ะปัะฑะพะน ัะปะพะน ะฑะตะท ัััะฝัั ะพะฟะตัะฐัะธะน ะฝะฐ VM

---

## ๐งฐ Tech stack

- Kubernetes (k3s)
- Cilium,
- Helm
- Argo CD
- Ansible
- Prometheus, Grafana, Alertmanager
- Loki, Promtail
- PostgreSQL
- Python
- Linux
